@model List<MedReminder.Shared.DTOs.MedicationDTO>

<h1>Your Medications</h1>

@if (Model.Any())
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Dosage</th>
                <th>Instructions</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var medication in Model)
            {
                <tr>
                    <td>@medication.Name</td>
                    <td>@medication.Dosage @medication.DosageUnit</td>
                    <td>@medication.Instructions</td>
                    <td>@medication.StartDate.ToShortDateString()</td>
                    <td>@medication.EndDate.ToShortDateString()</td>
                    <td>@medication.Description</td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm" onclick="confirmDelete(@medication.Id, @ViewData["UserId"])">Fjern</button>
                        <a asp-controller="Medication" asp-action="Edit" asp-route-id="@medication.Id" class="btn btn-warning btn-sm ms-2">Opdater</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

}
else
{
	<p class="text-muted">You don't have any medications yet.</p>
}

<a asp-controller="Medication" asp-action="Create" asp-route-userId="@ViewData["UserId"]" class="btn btn-primary mt-3">Tilføj</a>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function confirmDelete(medicationId, userId) {
        Swal.fire({
            title: 'Er du sikker?',
            text: "Denne handling kan ikke fortrydes",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Ja!',
            cancelButtonText: 'Annuller'
        }).then((result) => {
            if (result.isConfirmed) {
                const form = document.createElement('form');
                form.method = 'post';
                form.action = `/Medication/Delete`; 

                const idField = document.createElement('input');
                idField.type = 'hidden';
                idField.name = 'id';
                idField.value = medicationId;
                form.appendChild(idField);

                const userIdField = document.createElement('input');
                userIdField.type = 'hidden';
                userIdField.name = 'userId';
                userIdField.value = userId;
                form.appendChild(userIdField);

                document.body.appendChild(form);
                form.submit();
            }
        });
    }
</script>

